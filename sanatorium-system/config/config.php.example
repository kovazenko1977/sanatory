<?php
/**
 * Конфигурационный файл системы управления санаторием
 * 
 * ИНСТРУКЦИЯ:
 * 1. Скопируйте этот файл как config.php
 * 2. Настройте параметры под ваш сервер
 */

// Определяем корневую директорию проекта
define('ROOT_PATH', dirname(__DIR__));

// Путь к данным (JSON файлы)
define('DATA_PATH', ROOT_PATH . '/data');

// Путь к загрузкам
define('UPLOADS_PATH', ROOT_PATH . '/uploads');

// Валюта
define('CURRENCY_SYMBOL', '₽');

// Настройки отображения ошибок
// Для разработки: E_ALL и display_errors = 1
// Для продакшена: 0 и display_errors = 0
error_reporting(E_ALL);
ini_set('display_errors', 1);

// Часовой пояс
date_default_timezone_set('Europe/Moscow');

// Автозагрузка классов
spl_autoload_register(function ($class) {
    // Убираем namespace prefix
    $prefix = 'Sanatorium\\';
    $len = strlen($prefix);
    if (strncmp($prefix, $class, $len) !== 0) {
        return;
    }
    
    // Получаем относительное имя класса
    $relative_class = substr($class, $len);
    
    // Заменяем namespace разделители на разделители директорий
    $file = ROOT_PATH . '/classes/' . str_replace('\\', '/', $relative_class) . '.php';
    
    // Если файл существует, подключаем его
    if (file_exists($file)) {
        require $file;
    }
});

// Создаем необходимые директории, если их нет
$directories = [
    DATA_PATH,
    DATA_PATH . '/backups',
    UPLOADS_PATH . '/documents',
    UPLOADS_PATH . '/contracts'
];

foreach ($directories as $dir) {
    if (!is_dir($dir)) {
        mkdir($dir, 0755, true);
    }
}

// Простая функция проверки авторизации (заглушка)
// В реальном проекте здесь должна быть полноценная система авторизации
function checkAuth() {
    // Пока просто возвращаем true
    // TODO: Реализовать полноценную авторизацию
    return true;
}

// Функция для безопасного вывода данных
function e($string) {
    return htmlspecialchars($string, ENT_QUOTES, 'UTF-8');
}

// Функция для форматирования даты
function formatDate($date, $format = 'd.m.Y') {
    if (empty($date)) {
        return '';
    }
    return date($format, strtotime($date));
}

// Функция для форматирования суммы
function formatMoney($amount) {
    return number_format($amount, 0, ',', ' ') . ' ' . CURRENCY_SYMBOL;
}
